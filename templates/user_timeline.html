{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block base_style%}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'styles/user_timeline.css' %}">
    {% endblock base_style%}
    <title>Document</title>
</head>

<body">
    {% block content %}
    <center>
        <!-- {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}" {% endif %} style="background-color: rgb(224, 247, 251);">{{
            message }}</li>
            {% endfor %} -->
    </center>
    </center>
    <div class="famoustopicsmain">
        <div class="containflex">
            <div class="leftside">
                <h2>Confess to {{extracted_category}}</h2>
                {% for profiles in visited_user_profiles %}
                <div class="profileimg" onclick="toggleProfileImg()"
                    style="background-image: url('{{profiles.image.url }}');">

                </div>
                {% endfor %}
                <!-- Your Thoughts System Starts -->
                {% if request.user.username == extracted_category %}
                <h2>Confessions for You:</h2>
                {% else %}
                <h2>People Thoughts:</h2>
                {% endif %}
                {% if request.user.username != extracted_category %}
                <section class="thoughtsform">
                    <form action="" method="post" onsubmit="return validateForm()">
                        {% csrf_token %}
                        <label for="content">Your Thoughts</label>
                        <br>
                        <textarea name="content" id="content" onkeyup="onKey()"
                            placeholder="Say Something about {{extracted_category}}"></textarea>
                        <br>
                        <h3 id="messagejs"></h3>
                        <input type="submit" value="Post" class="postbtn">
                    </form>
                </section>
                {% endif %}
                <div class="commentbox">
                    {% for post in user_posts %}
                    <div class="comment" data-aos="fade-up">
                        <div class="imagepart">
                            <img src="{% static 'images/noone.png' %}" alt="userimg">
                        </div>
                        <div class="textpart">
                            <h4>Anonymous</h4>
                            <p>{{ post.content }}</p>
                        </div>
                        {% if request.user.username == extracted_category %}
                        <div class="deletepost">
                            <form action="../../user/{{extracted_category}}/deleteConfession/{{post.id}}/"
                                method="post">
                                {% csrf_token %}
                                <input class="deleteconfession" type="submit" value="X">
                            </form>
                        </div>
                        </form>

                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                <!-- Your Thoughts System Ends-->
            </div>
            <div class="rightside">
                <div class="flexwrapper" data-aos="fade-up">
                    <div class="one">
                        <center>
                            {% if actualdata <= 0 %} <h3 class="firsth3">Post must be one</h3>
                                <h3>or more than one</h3>
                                {% else %}
                                <h3>Received Messages: {{actualdata}}</h3>
                                <div id="container" style="width: 90%;">
                                    <canvas id="myChart1"></canvas>
                                </div>
                                {% endif %}
                        </center>
                    </div>
                    <div class="one">
                        <h3>Feature <span class="imgspan">Image</span></h3>
                        <div class="myday">
                            {% if not myfeature %}
                            {% if request.user.username != extracted_category %}
                            <h3>No Feature</h3>
                            {% else %}
                            <form action="" method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="file" id="file-input" accept="image/*" name="file-input"
                                    onchange="displayImage(this)" />
                                <label id="file-input-label" for="file-input">+</label>
                                <ul class="messages">
                                    {% for message in messages %}
                                    <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
                                        {% endfor %}
                                </ul>
                                <input type="submit" value="Post" class="postbtn">
                            </form>
                            {% endif %}
                            {% endif %}

                            {% for myfeature in myfeature %}
                            <div class="mydaycard" onclick="openFullScreen()"
                                style="background-image: url({{myfeature.file.url}});">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="onebottom">
                        <center>
                            {% if actualdata <= 0 %} <div class="gamyfication">
                                <img src="{% static 'images/nomedal.png' %}" alt="">
                                <h4>No Medal</h4>
                                {% elif actualdata > 0 and actualdata <= 20 %} <div class="gamyfication">
                                    <img src="{% static 'images/bronze.png' %}" alt="">
                                    <h4>Bronze Medal</h4>
                    </div>
                    {% elif actualdata > 20 and actualdata <= 100 %} <div class="gamyfication">
                        <img src="{% static 'images/silver.png' %}" alt="">
                        <h4>Silver Medal</h4>
                </div>
                {% elif actualdata > 100 and actualdata <= 500 %} <div class="gamyfication">
                    <img src="{% static 'images/gold.png' %}" alt="">
                    <h4>Gold Medal</h4>
            </div>
            {% endif %}
            </center>
        </div>
        <div class="onebottom">
            <div class="biocontent">
                <strong>Intro:</strong>
                {% for myintro in myintro %}
                <p>{{myintro.first_name}}
                </p>
                {% if request.user.username == extracted_category %}
                <button onclick="openPopup()" title="Edit intro" type="submit" style="margin: 0;">
                    <i class="fas fa-edit"></i>
                </button>
                {% endif %}
                {% endfor %}

            </div>
        </div>
    </div>
    <div class="particularstory">
        <center>
            {% if request.user.username == extracted_category %}
            <a href="{% url 'yourstory' %}">
                <button class="copybtn" style="width: 6em;">Your Story</button>
            </a>
            {% endif %}
        </center>
    </div>
    </div>
    </div>
    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modelcontents">
            <form method="post" action="{% url 'editIntro' %}">
                {% csrf_token %}
                <label for="">New Intro:</label>
                <br>
                <input type="text" name="newintro" class="newintro">
                <br>
                <br>
                <center>
                    <input type="button" name="cancel" value="Cancel" class="copybtn" onclick="closePopup()">
                    <input type="submit" name="Edit" value="Edit" class="copybtn">
                </center>
            </form>
        </div>
    </div>
    <!-- The Overlay -->
    <div id="overlay" class="overlay"></div>

    <!-- overlay for featured images -->
    {% for myfeature in myfeature %}
    <div id="fullscreen-overlay" class="fullscreen-overlay">
        <span class="close-btn" onclick="closeFullScreen()">
            <i class="fa-solid fa-x"></i>
        </span>
        {% if request.user.username == extracted_category %}
        <span class="delete-btn">
            <a style="color: white;" href="/user/{{extracted_category}}/deleteFeature/{{myfeature.id}}/">
                <i class="fa-solid fa-trash-can"></i>
            </a>
        </span>
        {% endif %}
        <img src="{{myfeature.file.url}}" alt="Large Image">
    </div>
    {% endfor %}
    </div>
    <script>
        // Function to open the popup
        function openPopup() {
            document.getElementById('myModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Function to close the popup
        function closePopup() {
            document.getElementById('myModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
    </script>
    <script>
        function openFullScreen() {
            var fullscreenOverlay = document.getElementById('fullscreen-overlay');
            fullscreenOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeFullScreen() {
            var fullscreenOverlay = document.getElementById('fullscreen-overlay');
            fullscreenOverlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        function displayImage(input) {
            var file = input.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('file-input-label').style.backgroundImage = 'url(' + e.target.result + ')';
                    document.getElementById('file-input-label').innerHTML = " ";
                };
                reader.readAsDataURL(file);
            }
        }
        // Script to stop bad comments and check content length
        const badWords = ["fuck", "bitch", "dick", "ass", "asshole", "pussy", "lado", "puti", "chikne", "machikne", "machikney", "machikni", "randi", "radi"];

        function onKey() {
            const contentValue = document.querySelector("#content").value.toLowerCase();
            const messageElement = document.querySelector("#messagejs");
            const contentLength = contentValue.replace(/\s/g, '').length; // Exclude spaces from length

            if (contentLength < 30) {
                messageElement.innerText = "Confession must be above 30 characters";
                document.querySelector(".postbtn").style.cursor = "not-allowed";
            } else {
                const hasBadWord = badWords.some(word => new RegExp(`\\b${word}\\b`).test(contentValue));

                if (hasBadWord) {
                    messageElement.innerText = "Bad Word Detected";
                    document.querySelector(".postbtn").style.cursor = "not-allowed";
                } else {
                    messageElement.innerText = "";
                    document.querySelector(".postbtn").style.cursor = "pointer";
                }
            }
        }

        function validateForm() {
            const contentValue = document.querySelector("#content").value.toLowerCase();
            const contentLength = contentValue.replace(/\s/g, '').length; // Exclude spaces

            if (contentLength < 30) {
                document.querySelector("#messagejs").innerText = "Confession must be above 30 characters";
                document.querySelector(".postbtn").style.cursor = "not-allowed";
                return false;
            }
            if (badWords.some(word => contentValue.includes(word))) {
                document.querySelector("#messagejs").innerText = "Bad Word Detected";
                document.querySelector(".postbtn").style.cursor = "not-allowed";
                return false;
            }

            return true;
        }

        // profile image click animation starts
        function profileimg() {
            if (window.innerWidth >= 600) {
                document.querySelector(".profileimg").style.height = "100vh";
                // document.querySelector(".profileimg").style.width = "90%";
                document.querySelector(".profileimg").style.backgroundSize = "cover";
            }
        }

        function toggleProfileImg() {
            var profileImg = document.querySelector(".profileimg");
            var rightSide = document.querySelector(".rightside");

            if (profileImg.style.height === "100vh") {
                profileImg.style.height = "";
                profileImg.style.width = "";
                profileImg.style.backgroundSize = "";
                // Show the right side if it was hidden
                // rightSide.style.display = "";
            } else {
                profileimg();
                // Hide the right side
                // rightSide.style.display = "none";
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <script>
        var ctx = document.getElementById('myChart1').getContext('2d');
        var myChart1 = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: {{ finaldate| safe}},
        datasets: [{
            label: 'Details',
            data: {{ date_count_list| safe}},
            backgroundColor: [
            'rgba(255, 63, 164, 1)',
            'rgba(117, 79, 254, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(54, 162, 135, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(151, 102, 132, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(54, 162, 135, 1)',
            'rgba(25, 206, 86, 1)',
            'rgba(211, 192, 192, 1)',
            'rgba(234, 102, 132, 1)',
            'rgba(153, 99, 132, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(255, 99, 132, 1)',
            'green',
            'yellow',
        ],

            borderColor: [
            'rgba(54, 162, 135, 1)',
            'rgba(25, 206, 86, 1)',
            'rgba(211, 192, 192, 1)',
            'rgba(234, 102, 132, 1)',
            'rgba(153, 99, 132, 1)',
            'rgba(255, 159, 64, 1)',

        ],

            borderWidth: 0
                }]
            },

        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
        })
    </script>
    {% endblock %}

    </body>

</html>